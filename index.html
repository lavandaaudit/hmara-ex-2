<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>IBONIRIUM ¬∑ Cloud Barometer ¬∑ Atmos</title>

<style>
body{
  margin:0;
  height:100vh;
  background:#0a0e14;
  font-family:monospace;
  color:#aaffcc;
  overflow:hidden;
}
#device{
  position:fixed;
  top:16px;
  left:16px;
  width:280px;
  height:220px;
  pointer-events:none;
}
canvas{ position:absolute; inset:0; }
#info{
  position:absolute;
  top:8px; left:12px;
  font-size:11px;
  line-height:1.35;
  text-shadow:0 0 4px #000;
}
#title{ font-size:13px; color:#9affe0; margin-bottom:4px; }
b{ color:#6fffa0; }
</style>
</head>

<body>

<div id="device">
<canvas id="cloud"></canvas>
<div id="info">
<div id="title">IBONIRIUM ¬∑ ATMOSPHERIC NODE</div>
<div>Weather: <b id="wcode">‚Äì</b></div>
<div>Cloud: <b id="cc">‚Äì</b>%</div>
<div>Humidity: <b id="hum">‚Äì</b>%</div>
<div>Wind: <b id="wind">‚Äì</b> m/s</div>
<div>Pressure: <b id="pres">‚Äì</b> hPa</div>
<div>Visibility: <b id="vis">‚Äì</b> km</div>
<div>Cloud factor: <b id="cf">‚Äì</b></div>
</div>
</div>

<script>
const canvas=document.getElementById("cloud");
const ctx=canvas.getContext("2d");
canvas.width=280; canvas.height=220;

// ================================
let cloudCover=0, humidity=50, weatherCode=0;
let windSpeed=0, windDir=0, pressure=1013;
let visibility=10, temperature=10;
let baseColor={r:235,g:245,b:255};

// ================================
const noise=(x,y)=>Math.sin(x*17.3+y*91.7)*0.5+0.5;

// ================================
function drawCloud(){
  const t=Date.now()*0.00045;
  const w=canvas.width,h=canvas.height;
  const cx=w*0.52, cy=h*0.5;

  ctx.clearRect(0,0,w,h);

  const windX=Math.cos(windDir*Math.PI/180)*windSpeed*0.06;
  const windY=Math.sin(windDir*Math.PI/180)*windSpeed*0.04;

  const turbulence=Math.max(0,(windSpeed-6)/6);
  const layers=5;
  const baseSize=62+cloudCover*0.45+(1015-pressure);

  for(let i=0;i<layers;i++){
    ctx.globalAlpha=(0.18+i*0.1)*(humidity/120+0.4);
    const scale=0.009+i*0.003;

    for(let y=0;y<h;y+=3){
      for(let x=0;x<w;x+=3){
        let nx=(x-cx)*scale+windX*t;
        let ny=(y-cy)*scale+windY*t;

        // üåÄ —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω—ñ —Ä–æ–∑—Ä–∏–≤–∏
        nx+=noise(nx+t,ny)*turbulence*1.5;
        ny+=noise(nx*2,ny+t)*turbulence;

        let n=noise(nx+t,ny)*0.6+noise(nx*2.2,ny*2.2)*0.4;

        const dist=Math.hypot(x-cx,y-cy)/baseSize;
        let falloff=Math.max(0,1-dist*dist*1.4);
        falloff=Math.pow(falloff,1.2);

        // —Ä–æ–∑—Ä–∏–≤–∏
        if(turbulence>0.2 && noise(nx*6,ny*6)>0.85) falloff*=0.25;

        if(n*falloff>0.38){
          const br=n*1.2;
          ctx.fillStyle=`rgba(
            ${Math.min(255,baseColor.r*br)},
            ${Math.min(255,baseColor.g*br)},
            ${Math.min(255,baseColor.b*br)},
            ${falloff}
          )`;
          ctx.fillRect(x,y,3,3);
        }
      }
    }
  }
  ctx.globalAlpha=1;
}

// ================================
// üåßÔ∏è –î–æ—â
function drawRain(){
  ctx.strokeStyle="rgba(170,220,255,0.25)";
  ctx.lineWidth=1;
  for(let i=0;i<60;i++){
    const x=Math.random()*canvas.width;
    const y=Math.random()*canvas.height;
    ctx.beginPath();
    ctx.moveTo(x,y);
    ctx.lineTo(x+windSpeed*0.8,y+10+windSpeed*2);
    ctx.stroke();
  }
}

// üå´Ô∏è –¢—É–º–∞–Ω
function drawFog(){
  ctx.fillStyle="rgba(220,240,255,0.06)";
  for(let i=0;i<20;i++){
    ctx.beginPath();
    ctx.arc(
      Math.random()*canvas.width,
      Math.random()*canvas.height,
      30+Math.random()*40,0,Math.PI*2
    );
    ctx.fill();
  }
}

// üå©Ô∏è –ï–ª–µ–∫—Ç—Ä–∏—á–Ω—ñ —ñ–º–ø—É–ª—å—Å–∏
function drawLightning(){
  if(Math.random()>0.02) return;
  ctx.strokeStyle="rgba(200,220,255,0.9)";
  ctx.lineWidth=1.5;
  ctx.beginPath();
  let x=canvas.width*0.5;
  let y=canvas.height*0.25;
  ctx.moveTo(x,y);
  for(let i=0;i<6;i++){
    x+=Math.random()*20-10;
    y+=15+Math.random()*10;
    ctx.lineTo(x,y);
  }
  ctx.stroke();
}

// ================================
async function updateWeather(){
  const r=await fetch(
    "https://api.open-meteo.com/v1/forecast?latitude=50.45&longitude=30.52&current=" +
    "relative_humidity_2m,cloud_cover,weather_code," +
    "wind_speed_10m,wind_direction_10m,surface_pressure,visibility,temperature_2m"
  );
  const c=(await r.json()).current;

  weatherCode=c.weather_code;
  cloudCover=c.cloud_cover;
  humidity=c.relative_humidity_2m;
  windSpeed=c.wind_speed_10m;
  windDir=c.wind_direction_10m;
  pressure=c.surface_pressure;
  visibility=c.visibility/1000;
  temperature=c.temperature_2m;

  cf.textContent=(0.6+cloudCover/45+windSpeed/15).toFixed(2);
  wcode.textContent=weatherCode;
  cc.textContent=cloudCover;
  hum.textContent=humidity;
  wind.textContent=windSpeed.toFixed(1);
  pres.textContent=pressure.toFixed(0);
  vis.textContent=visibility.toFixed(1);
}
updateWeather();
setInterval(updateWeather,15*60*1000);

// ================================
function loop(){
  drawCloud();

  if(weatherCode>=50 && weatherCode<=82) drawRain();
  if(weatherCode>=45 && weatherCode<=48 || visibility<3) drawFog();
  if(weatherCode>=95) drawLightning();

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
